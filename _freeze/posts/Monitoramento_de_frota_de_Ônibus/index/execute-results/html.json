{
  "hash": "16aaa2ca620b070188f3482debb5a590",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Monitoramento de Frota de Ônibus\"\nauthor: \"Maurício 225059\"\ndate: \"2025-11-22\"\ncategories: [code, onibus, frota, monitoramento]\nimage: \"ladoempresa2.jpg\"\njupyter: python3\n---\n\nNesta atividade apresenta um sistema simples de monitoramento de ônibus usando a API Olho Vivo da SPTrans. O programa obtém as paradas e a localização em tempo real da linha escolhida e exibe tudo em um mapa interativo.\n\n::: {#9b9fcc3d .cell execution_count=1}\n``` {.python .cell-code}\nimport requests\nimport folium\nfrom IPython.display import display\n\n# token e base da API\nTOKEN = \"b3745755617c6a4c7487c1a93d2cfae0968e31fdf7e427395078bb2237987c5f\"\nBASE_URL = \"http://api.olhovivo.sptrans.com.br/v2.1\"\n\n# linha usada\nLINHA = \"875A-10\"\n\n# login\ns = requests.Session()\ns.post(f\"{BASE_URL}/Login/Autenticar?token={TOKEN}\")\n\n# busca a linha\nresp_linha = s.get(f\"{BASE_URL}/Linha/Buscar?termosBusca={LINHA}\").json()\n\n# se não achar a linha\nif not resp_linha:\n    print(\"A API não encontrou essa linha.\")\n    exit()\n\ncodigo_linha = resp_linha[0][\"cl\"]\n\n# busca paradas da linha\nparadas = s.get(\n    f\"{BASE_URL}/Parada/BuscarParadasPorLinha?codigoLinha={codigo_linha}\"\n).json()\n\n# se não achar paradas\nif not paradas:\n    print(\"A API não retornou paradas para essa linha. Tente outra linha.\")\n    exit()\n\n# busca posição dos ônibus\npos = s.get(f\"{BASE_URL}/Posicao?codigoLinha={codigo_linha}\").json()\nonibus = pos.get(\"vs\", [])\n\n# centraliza no primeiro ponto encontrado\nlat_central = paradas[0][\"py\"]\nlon_central = paradas[0][\"px\"]\n\nmapa = folium.Map(location=[lat_central, lon_central], zoom_start=13)\n\n# adiciona paradas (vermelho)\nfor p in paradas:\n    folium.Marker(\n        location=[p[\"py\"], p[\"px\"]],\n        icon=folium.Icon(color=\"red\"),\n        popup=p[\"np\"]\n    ).add_to(mapa)\n\n# adiciona ônibus (azul)\nfor v in onibus:\n    folium.CircleMarker(\n        location=[v[\"py\"], v[\"px\"]],\n        radius=7,\n        color=\"blue\",\n        fill=True\n    ).add_to(mapa)\n\n# salva o arquivo\nmapa.save(\"mapa.html\")\nprint(\"Mapa gerado: mapa.html\")\nfrom IPython.display import HTML\n\nHTML('<object data=\"mapa.html\" width=\"100%\" height=\"600px\"></object>')\ndisplay(mapa)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nMapa gerado: mapa.html\n```\n:::\n\n::: {.cell-output .cell-output-display}\n```{=html}\n<div style=\"width:100%;\"><div style=\"position:relative;width:100%;height:0;padding-bottom:60%;\"><span style=\"color:#565656\">Make this Notebook Trusted to load map: File -> Trust Notebook</span><iframe srcdoc=\"&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    \n    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;\n    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://code.jquery.com/jquery-3.7.1.min.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/&gt;\n    \n            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,\n                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;\n            &lt;style&gt;\n                #map_da9b6ffc7072e3525d57878ef718f6a8 {\n                    position: relative;\n                    width: 100.0%;\n                    height: 100.0%;\n                    left: 0.0%;\n                    top: 0.0%;\n                }\n                .leaflet-container { font-size: 1rem; }\n            &lt;/style&gt;\n\n            &lt;style&gt;html, body {\n                width: 100%;\n                height: 100%;\n                margin: 0;\n                padding: 0;\n            }\n            &lt;/style&gt;\n\n            &lt;style&gt;#map {\n                position:absolute;\n                top:0;\n                bottom:0;\n                right:0;\n                left:0;\n                }\n            &lt;/style&gt;\n\n            &lt;script&gt;\n                L_NO_TOUCH = false;\n                L_DISABLE_3D = false;\n            &lt;/script&gt;\n\n        \n&lt;/head&gt;\n&lt;body&gt;\n    \n    \n            &lt;div class=&quot;folium-map&quot; id=&quot;map_da9b6ffc7072e3525d57878ef718f6a8&quot; &gt;&lt;/div&gt;\n        \n&lt;/body&gt;\n&lt;script&gt;\n    \n    \n            var map_da9b6ffc7072e3525d57878ef718f6a8 = L.map(\n                &quot;map_da9b6ffc7072e3525d57878ef718f6a8&quot;,\n                {\n                    center: [-23.534377, -46.654322],\n                    crs: L.CRS.EPSG3857,\n                    ...{\n  &quot;zoom&quot;: 13,\n  &quot;zoomControl&quot;: true,\n  &quot;preferCanvas&quot;: false,\n}\n\n                }\n            );\n\n            \n\n        \n    \n            var tile_layer_846799ab2c5422241fe25477d4d594f8 = L.tileLayer(\n                &quot;https://tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,\n                {\n  &quot;minZoom&quot;: 0,\n  &quot;maxZoom&quot;: 19,\n  &quot;maxNativeZoom&quot;: 19,\n  &quot;noWrap&quot;: false,\n  &quot;attribution&quot;: &quot;\\u0026copy; \\u003ca href=\\&quot;https://www.openstreetmap.org/copyright\\&quot;\\u003eOpenStreetMap\\u003c/a\\u003e contributors&quot;,\n  &quot;subdomains&quot;: &quot;abc&quot;,\n  &quot;detectRetina&quot;: false,\n  &quot;tms&quot;: false,\n  &quot;opacity&quot;: 1,\n}\n\n            );\n        \n    \n            tile_layer_846799ab2c5422241fe25477d4d594f8.addTo(map_da9b6ffc7072e3525d57878ef718f6a8);\n        \n    \n            var marker_47201c9fb59849aaf3d09f4280720531 = L.marker(\n                [-23.534377, -46.654322],\n                {\n}\n            ).addTo(map_da9b6ffc7072e3525d57878ef718f6a8);\n        \n    \n            var icon_4ffdc8269380fa957e747577c7f08d87 = L.AwesomeMarkers.icon(\n                {\n  &quot;markerColor&quot;: &quot;red&quot;,\n  &quot;iconColor&quot;: &quot;white&quot;,\n  &quot;icon&quot;: &quot;info-sign&quot;,\n  &quot;prefix&quot;: &quot;glyphicon&quot;,\n  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n}\n            );\n        \n    \n        var popup_9239374479f58401dec090a4ba6e7670 = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_83aba22cc7c0d57e5beb210dc24cfc4a = $(`&lt;div id=&quot;html_83aba22cc7c0d57e5beb210dc24cfc4a&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;ANGELICA C/B&lt;/div&gt;`)[0];\n                popup_9239374479f58401dec090a4ba6e7670.setContent(html_83aba22cc7c0d57e5beb210dc24cfc4a);\n            \n        \n\n        marker_47201c9fb59849aaf3d09f4280720531.bindPopup(popup_9239374479f58401dec090a4ba6e7670)\n        ;\n\n        \n    \n    \n                marker_47201c9fb59849aaf3d09f4280720531.setIcon(icon_4ffdc8269380fa957e747577c7f08d87);\n            \n    \n            var marker_d85802d484d30762c22100157b2bcffa = L.marker(\n                [-23.551843, -46.657399],\n                {\n}\n            ).addTo(map_da9b6ffc7072e3525d57878ef718f6a8);\n        \n    \n            var icon_48cf4e4ff2e0ff54af0e575c03e06ed5 = L.AwesomeMarkers.icon(\n                {\n  &quot;markerColor&quot;: &quot;red&quot;,\n  &quot;iconColor&quot;: &quot;white&quot;,\n  &quot;icon&quot;: &quot;info-sign&quot;,\n  &quot;prefix&quot;: &quot;glyphicon&quot;,\n  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n}\n            );\n        \n    \n        var popup_599c6e12c6489cf16ae25360800284d0 = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_af0b4a282d42a2b2d89571e133dfbe3b = $(`&lt;div id=&quot;html_af0b4a282d42a2b2d89571e133dfbe3b&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;PEDRO TAQUES B/C&lt;/div&gt;`)[0];\n                popup_599c6e12c6489cf16ae25360800284d0.setContent(html_af0b4a282d42a2b2d89571e133dfbe3b);\n            \n        \n\n        marker_d85802d484d30762c22100157b2bcffa.bindPopup(popup_599c6e12c6489cf16ae25360800284d0)\n        ;\n\n        \n    \n    \n                marker_d85802d484d30762c22100157b2bcffa.setIcon(icon_48cf4e4ff2e0ff54af0e575c03e06ed5);\n            \n    \n            var marker_440c60fd530eccc23d16049d07180056 = L.marker(\n                [-23.549577, -46.653216],\n                {\n}\n            ).addTo(map_da9b6ffc7072e3525d57878ef718f6a8);\n        \n    \n            var icon_b98700d3f3d6110a596ca88fbea85bbe = L.AwesomeMarkers.icon(\n                {\n  &quot;markerColor&quot;: &quot;red&quot;,\n  &quot;iconColor&quot;: &quot;white&quot;,\n  &quot;icon&quot;: &quot;info-sign&quot;,\n  &quot;prefix&quot;: &quot;glyphicon&quot;,\n  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n}\n            );\n        \n    \n        var popup_5077e336efc114287be9dce30aa4ca19 = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_b8815582b1cb2842a49aafe4a7a10f01 = $(`&lt;div id=&quot;html_b8815582b1cb2842a49aafe4a7a10f01&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;ANTÔNIA DE QUEIRÓS - B/C&lt;/div&gt;`)[0];\n                popup_5077e336efc114287be9dce30aa4ca19.setContent(html_b8815582b1cb2842a49aafe4a7a10f01);\n            \n        \n\n        marker_440c60fd530eccc23d16049d07180056.bindPopup(popup_5077e336efc114287be9dce30aa4ca19)\n        ;\n\n        \n    \n    \n                marker_440c60fd530eccc23d16049d07180056.setIcon(icon_b98700d3f3d6110a596ca88fbea85bbe);\n            \n    \n            var marker_0ae7f88347af414366f9965b7a219e8c = L.marker(\n                [-23.548174, -46.649565],\n                {\n}\n            ).addTo(map_da9b6ffc7072e3525d57878ef718f6a8);\n        \n    \n            var icon_99bf75d8de50875e7b9e9c2913fd985e = L.AwesomeMarkers.icon(\n                {\n  &quot;markerColor&quot;: &quot;red&quot;,\n  &quot;iconColor&quot;: &quot;white&quot;,\n  &quot;icon&quot;: &quot;info-sign&quot;,\n  &quot;prefix&quot;: &quot;glyphicon&quot;,\n  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n}\n            );\n        \n    \n        var popup_e81e738876fd6dccb45c24c9e6920351 = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_73bf47f4fb87bb9597c2d436adaf2e97 = $(`&lt;div id=&quot;html_73bf47f4fb87bb9597c2d436adaf2e97&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;CAIO PRADO B/C&lt;/div&gt;`)[0];\n                popup_e81e738876fd6dccb45c24c9e6920351.setContent(html_73bf47f4fb87bb9597c2d436adaf2e97);\n            \n        \n\n        marker_0ae7f88347af414366f9965b7a219e8c.bindPopup(popup_e81e738876fd6dccb45c24c9e6920351)\n        ;\n\n        \n    \n    \n                marker_0ae7f88347af414366f9965b7a219e8c.setIcon(icon_99bf75d8de50875e7b9e9c2913fd985e);\n            \n    \n            var marker_4fac93fac3f78599aafb7c28058d6d45 = L.marker(\n                [-23.532629, -46.657465],\n                {\n}\n            ).addTo(map_da9b6ffc7072e3525d57878ef718f6a8);\n        \n    \n            var icon_df2cf142c0ce69593699ec1587cc7ddf = L.AwesomeMarkers.icon(\n                {\n  &quot;markerColor&quot;: &quot;red&quot;,\n  &quot;iconColor&quot;: &quot;white&quot;,\n  &quot;icon&quot;: &quot;info-sign&quot;,\n  &quot;prefix&quot;: &quot;glyphicon&quot;,\n  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n}\n            );\n        \n    \n        var popup_74eeec00995508f30e8be6e6f4b7e590 = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_b829c97e4fe0ad0ed11dd994926abe6b = $(`&lt;div id=&quot;html_b829c97e4fe0ad0ed11dd994926abe6b&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;ROSA E SILVA C/B&lt;/div&gt;`)[0];\n                popup_74eeec00995508f30e8be6e6f4b7e590.setContent(html_b829c97e4fe0ad0ed11dd994926abe6b);\n            \n        \n\n        marker_4fac93fac3f78599aafb7c28058d6d45.bindPopup(popup_74eeec00995508f30e8be6e6f4b7e590)\n        ;\n\n        \n    \n    \n                marker_4fac93fac3f78599aafb7c28058d6d45.setIcon(icon_df2cf142c0ce69593699ec1587cc7ddf);\n            \n    \n            var marker_9eb04abe36b6c05c8aeb22e967b82fac = L.marker(\n                [-23.531864, -46.660859],\n                {\n}\n            ).addTo(map_da9b6ffc7072e3525d57878ef718f6a8);\n        \n    \n            var icon_2945796f5e7085169e90a498ec960607 = L.AwesomeMarkers.icon(\n                {\n  &quot;markerColor&quot;: &quot;red&quot;,\n  &quot;iconColor&quot;: &quot;white&quot;,\n  &quot;icon&quot;: &quot;info-sign&quot;,\n  &quot;prefix&quot;: &quot;glyphicon&quot;,\n  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n}\n            );\n        \n    \n        var popup_b5e4cbdc8094e53fbe886e1fc564c993 = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_e399dc8bcb4646d302840dc5deaeb6df = $(`&lt;div id=&quot;html_e399dc8bcb4646d302840dc5deaeb6df&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;PACAEMBU C/B&lt;/div&gt;`)[0];\n                popup_b5e4cbdc8094e53fbe886e1fc564c993.setContent(html_e399dc8bcb4646d302840dc5deaeb6df);\n            \n        \n\n        marker_9eb04abe36b6c05c8aeb22e967b82fac.bindPopup(popup_b5e4cbdc8094e53fbe886e1fc564c993)\n        ;\n\n        \n    \n    \n                marker_9eb04abe36b6c05c8aeb22e967b82fac.setIcon(icon_2945796f5e7085169e90a498ec960607);\n            \n    \n            var marker_c7a2c4f51a00dcc0cbb07d3c9c2f3639 = L.marker(\n                [-23.536498, -46.650579],\n                {\n}\n            ).addTo(map_da9b6ffc7072e3525d57878ef718f6a8);\n        \n    \n            var icon_665b02d232606b8a23910f2976339269 = L.AwesomeMarkers.icon(\n                {\n  &quot;markerColor&quot;: &quot;red&quot;,\n  &quot;iconColor&quot;: &quot;white&quot;,\n  &quot;icon&quot;: &quot;info-sign&quot;,\n  &quot;prefix&quot;: &quot;glyphicon&quot;,\n  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n}\n            );\n        \n    \n        var popup_e59c4b19672215beca50f7d78286e0b7 = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_a1b707399946d3ac4a86143e1540d41b = $(`&lt;div id=&quot;html_a1b707399946d3ac4a86143e1540d41b&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;NOTHMANN C/B&lt;/div&gt;`)[0];\n                popup_e59c4b19672215beca50f7d78286e0b7.setContent(html_a1b707399946d3ac4a86143e1540d41b);\n            \n        \n\n        marker_c7a2c4f51a00dcc0cbb07d3c9c2f3639.bindPopup(popup_e59c4b19672215beca50f7d78286e0b7)\n        ;\n\n        \n    \n    \n                marker_c7a2c4f51a00dcc0cbb07d3c9c2f3639.setIcon(icon_665b02d232606b8a23910f2976339269);\n            \n    \n            tile_layer_846799ab2c5422241fe25477d4d594f8.addTo(map_da9b6ffc7072e3525d57878ef718f6a8);\n        \n    \n                marker_47201c9fb59849aaf3d09f4280720531.setIcon(icon_4ffdc8269380fa957e747577c7f08d87);\n            \n    \n                marker_d85802d484d30762c22100157b2bcffa.setIcon(icon_48cf4e4ff2e0ff54af0e575c03e06ed5);\n            \n    \n                marker_440c60fd530eccc23d16049d07180056.setIcon(icon_b98700d3f3d6110a596ca88fbea85bbe);\n            \n    \n                marker_0ae7f88347af414366f9965b7a219e8c.setIcon(icon_99bf75d8de50875e7b9e9c2913fd985e);\n            \n    \n                marker_4fac93fac3f78599aafb7c28058d6d45.setIcon(icon_df2cf142c0ce69593699ec1587cc7ddf);\n            \n    \n                marker_9eb04abe36b6c05c8aeb22e967b82fac.setIcon(icon_2945796f5e7085169e90a498ec960607);\n            \n    \n                marker_c7a2c4f51a00dcc0cbb07d3c9c2f3639.setIcon(icon_665b02d232606b8a23910f2976339269);\n            \n&lt;/script&gt;\n&lt;/html&gt;\" style=\"position:absolute;width:100%;height:100%;left:0;top:0;border:none !important;\" allowfullscreen webkitallowfullscreen mozallowfullscreen></iframe></div></div>\n```\n:::\n:::\n\n\nO mapa é gerado no código, porém não consegui exibir ele no blog.\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js\" integrity=\"sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js\" integrity=\"sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}